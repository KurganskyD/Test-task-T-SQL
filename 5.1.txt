/*Эта процедура вызывается каждый раз при опускании монеты. Она получает на вход цену продукта от предыдущей и от устройства приема монет, 
какая монета опущена (номинал).*/
CREATE PROCEDURE [dbo].[AddCoins] @nominal INT, @price INT  /* Процедура получает два параметра, первый от технического устройства
принимающего деньги об их наминали, а второй - цена напитка - от предыдущей процедуры */
AS
UPDATE COUSTOMER_COINS SET number += 1 WHERE nominal LIKE @nominal --Обновляем кол-во денег на счете соотвествующего номинала
IF (SELECT SUM(nominal*number) FROM COUSTOMER_COINS) >= @price -- Проверка достаточно ли денег для покупки
	RETURN 0 --Если достаточно, то возвращаем 0 и прекращаем принимать деньги
ELSE 
	RETURN 1 --Если недостаточно то возвращаем 1 и при следующем опускании монеты снова вызовется эта процедура
